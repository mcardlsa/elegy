<?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Category_model extends CI_Model {

	private $category_table	= "categories"; 	// main model table 	
	
	public function __construct()
	{
		
	}	
	
	/**
	* Function to get all categories
	*
	* @author	KS
	* @param	none
	* @return	array
	*/	
	public function category_listing($param)
	{
		if(isset($param['action']) && $param['action']=='categorySearch') {
			$this->db->like("{$this->category_table}.categoryName",$param['text_search'],'after');
		}
		$response = $this->db->get($this->category_table);
		if($response->num_rows()>0)
		{
			$result['categoryList'] = $response->result();
			$result['message'] = "success";
			$result['status'] = 200;
		}
		else
		{
			$result['message'] = "No category found.";
			$result['status'] = 202;
		}
		return $result;
	}
	
	/**
	* Function to Counting the number of Category
	*
	* @author        Shashank
	* @param         array
	* @return        array
	*/
    public function record_count($searchStr = NULL) 
	{
		if(isset($searchStr)){
		$this->db->like('categoryName', $searchStr,'after');

		}
		$this->db->select("{$this->category_table}.categoryId,categoryName");
		 $count = $this->db->count_all_results($this->category_table);
		//echo $this->db->last_query();
		return $count;
    }
	

	/**
	* Function to LISTING
	*
	* @author      Shashank
	* @param        var,var,var
	* @return       array
	*/
    public function all_category($limit, $start,$searchStr)
	{        
		if(isset($searchStr)){
			$this->db->like('categoryName', $searchStr,'after');
			
		}
		
		if($start!=0){
				$start = (($start-1) * $limit);
		}  
	   
		$this->db->limit($limit, $start);
		$this->db->order_by("categoryName", "asc");
		$this->db->select("{$this->category_table}.categoryId,categoryName");                        
		$response = $this->db->get($this->category_table);                
		//echo $this->db->last_query();
		return $response->result_array();
	}
	
	/**
	* Function to add single Category 
	*
	* @author	Shashank
	* @param	array
	* @return	array
	*/	
	public function add_category($param)
	{
		$fields = array();
		
		$fields['categoryName'] = $param['categoryName'];
		$fields['categoryCreateTime'] = date('Y-m-d H:i:s');
		$res_ins = $this->db->insert($this->category_table, $fields);
		if($res_ins){
			$result['categoryInfo'] = $this->get_category($fields);
			
			$result['message'] = "success";
			$result['status'] = 200;
		}else{
			$result['message'] = "There is something wrong, try after sometime.";
			$result['status'] = 202;
		}
		//pr($result);
		return $result;
	}
	
	/**
	* Function to get single Category
	*
	* @author	Shashank
	* @param	array
	* @return	object array
	*/
	public function get_category($param)
	{
		$this->db->order_by("{$this->category_table}.categoryName", "asc");	
		$this->db->select("{$this->category_table}.categoryId,categoryName");     
		
		$response = $this->db->get($this->category_table);
		return $response->result();
	}
	
	/**
	* Function to update the Category
	*
	* @author        Shashank
	* @param         array
	* @return        array
	*/
	public function update_category($param)
	{
		$fields = array();
		$fields1=array();
	   // pr($param);
		
		$fields['categoryName'] = $param['categoryName'];
		           
		$res_ins=$this->db->where('categoryId',$param['categoryId']);
		$res_ins = $this->db->update($this->category_table, $fields);
		if($res_ins){
				$result['categoryInfo'] = $this->get_category($fields);
				$result['message'] = "success";
				$result['status'] = 200;
		}else{
				$result['message'] = "Insert query failed.";
				$result['status'] = 202;
		}
		return $result;
	}
		/**
	* Function to Category detail
	*
	* @author        Shashank
	* @param         var
	* @return        array
	*/
    public function category_detail($id)
    {        
        if(isset($id))
        { 
			$this->db->select("{$this->category_table}.categoryId,categoryName");     
			$this->db->where('categoryId',$id);                
			$response = $this->db->get($this->category_table);                
			//echo $this->db->last_query();
			return $response->result_array();
        }
    }
	   
	/**
	* Function to deleting the Category
	*
	* @author        Shashank
	* @param         var
	* @return        array
	*/ 
	function category_delete($id)
    {
		return $this->db->delete($this->category_table, array('categoryId' => $id));
    }



}
	