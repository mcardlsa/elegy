<?php defined('BASEPATH') OR exit('No direct script access allowed');

/**
 * Example
 *
 * This is an example of a few basic user interaction methods you could use
 * all done with a hardcoded array.
 *
 * @package		CodeIgniter
 * @subpackage	Rest Server
 * @category	Controller
 * @author		Phil Sturgeon
 * @link		http://philsturgeon.co.uk/code/
*/

// This can be removed if you use __autoload() in config.php OR use Modular Extensions
require APPPATH.'/libraries/REST_Controller.php';

class Funeral extends REST_Controller
{
	public function __construct()
	{
		parent::__construct();
		
		$this->load->model('Funeral_model');
		$this->load->model('User_model');
	}

 /**
	* Function to get list of funeral in which user invited or created by himself
	*
	* @author	KS
	* @param	data JSON Array
	* @return	HTTP response JSON
	*/
	function funerals_post()
	{ 
		$x		= stripslashes($this->input->post('data'));
        $data	= json_decode($x,true);
		
		$mandatory_key = array('userToken');
				
		if(! mandatory_params_present($mandatory_key,$data,$missing_param))
        {
            $response['message'] = "missing mandatory parameter : $missing_param";
            $response['status'] = "201";
			
			$this->response($response, 200); // 200 being the HTTP response code
        } 
		else
        {
			$userTokenStatus = $this->User_model->check_usertoken_validation($data);
			if($userTokenStatus['status'] == 200)
			{
				$emailId=$this->User_model->get_email_by_userToken($data['userToken']);
				$result=$this->Funeral_model->get_funeral_list($emailId);
				if($result)
				{
				$response['funerals']= $result;
				$response['message'] = "Success";
            	$response['status'] = "200";
				$this->response($response, 200); // 200 being the HTTP response code
				}else
				{
				$response['message'] = "No Result found";
            	$response['status'] = "202";
				}
			}
			else
			{
				$this->response($userTokenStatus, 200); // 200 being the HTTP response code
			}	
        }	
	}
	
	
	 /**
	* Function to get detail of funeral 
	*
	* @author	KS
	* @param	data JSON Array
	* @return	HTTP response JSON
	*/
	function funeral_details_post()
	{ 
	$x		= stripslashes($this->input->post('data'));
        $data	= json_decode($x,true);
		
		$mandatory_key = array('userToken', 'invitationCode');
				
		if(! mandatory_params_present($mandatory_key,$data,$missing_param))
        {
            $response['message'] = "missing mandatory parameter : $missing_param";
            $response['status'] = "201";
			
			$this->response($response, 200); // 200 being the HTTP response code
        }else
        {
        
        	$userTokenStatus = $this->User_model->check_usertoken_validation($data);
			if($userTokenStatus['status'] == 200)
			{
				$result=$this->Funeral_model->get_funeral_detail_by_invitationCode($data['invitationCode']);
				if($result)
				{
				$response['funerals']= $result;
				$response['message'] = "Success";
            	$response['status'] = "200";
				$this->response($response, 200); // 200 being the HTTP response code
				}else
				{
				$response['message'] = "No Result found";
            	$response['status'] = "202";
				}
			}
			else
			{
				$this->response($userTokenStatus, 200); // 200 being the HTTP response code
			}
        
        }
	
	}
	
}
?>
